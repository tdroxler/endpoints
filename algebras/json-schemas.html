<!DOCTYPE html>
<html class="no-js" lang="eng" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSON schemas</title>
    <link rel="stylesheet" href="../theme/css/foundation.min.css">
    <link rel="stylesheet" href="../theme/css/app.css">
    
     <link rel="stylesheet" href="../theme/highlight.js/styles/github-gist.css">  <link rel="stylesheet" href="../theme/css/foundation-icons.custom.css"> 
    
     <link rel="toc" href="../site-contents.html"  title="Table of Contents"  /> 
  </head>
  <body>
    <div class="expanded row">
      <div class="small-12 medium-12 large-12 columns align-self-top">
        <div class="row">
          
          <header class="large-12 columns align-self-top a_header">
            <div class="row">
              <div class="large-12 columns a_limited top-bar">
                <div class="top-bar-left">
                  <p>endpoints 0.8.0</p>

                </div>
                <div class="top-bar-right align-right row">
                  
                  
                    <form action="../site-search.html" method="get" class="align-right a_search">
                      <input name="q" type="search"  placeholder="Search
" >
                      <button><img alt="&#1F50D;" src="../theme/images/search.svg" /></button>
                    </form>
                  
                </div>
              </div>
            </div>
          </header>
          
          <div class="small-12 medium-12 large-12 columns align-self-top a_limited a_main">
            <div class="row">
              
              <main class="columns large-order-2 sections" id="_sections">
                 
  <ul class="menu align-right simple a_navbar a_navbar_top">
    
      
        <li><a href="../site-contents.html"  title="Table of Contents" ><span class="a_foundation_icon"></span>  Contents</a></li>
      
    
  </ul>
 
                
                <h1 id="json-schemas" class="a_section" data-magellan-target="json-schemas">JSON schemas<a class="a_hlink" href="#json-schemas"></a></h1>
<h2 id="jsonschemas" class="a_section" data-magellan-target="jsonschemas"><code class="hljs">JsonSchemas</code><a class="a_hlink" href="#jsonschemas"></a></h2>
<p>This algebra provides vocabulary to define JSON schemas of data types.</p>
<div class="row"><div class="a_linked small-expand columns a_xscroll a_codeblock">
<pre class="hljs"><code class="language-scala"><span class="hljs-string">"org.julienrf"</span> %% <span class="hljs-string">"endpoints-algebra-json-schema"</span> % <span class="hljs-string">"0.8.0"</span>
</code></pre>
</div></div>
<p><a href="../api/0.8.0/index.html#endpoints.algebra.JsonSchemas">API documentation</a></p>
<blockquote class="note">
<p>This module is dependency-free, it can be used independently of <em>endpoints</em>
to define JSON schemas and interpret them as actual encoder, decoders or
documentation.</p>
</blockquote>
<p>The algebra introduces the concept of <code class="hljs">JsonSchema[A]</code>: a JSON schema for a type <code class="hljs">A</code>.</p>
<h3 id="basic-types-and-record-types" class="a_section" data-magellan-target="basic-types-and-record-types">Basic types and record types<a class="a_hlink" href="#basic-types-and-record-types"></a></h3>
<p>The trait provides some predefined JSON schemas (for <code class="hljs">String</code>, <code class="hljs">Int</code>, <code class="hljs">Boolean</code>, etc.)
and ways to combine them together to build more complex schemas.</p>
<p>For instance, given the following <code class="hljs">Rectangle</code> data type:</p>
<div class="row"><div class="a_linked small-expand columns a_xscroll a_codeblock">
<pre class="hljs"><code class="language-scala"><span class="hljs-keyword">case</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Rectangle</span>(<span class="hljs-params">width: <span class="hljs-type">Double</span>, height: <span class="hljs-type">Double</span></span>)</span></code></pre>
<a href="https://github.com/julienrf/endpoints/blob/v0.8.0/json-schema/json-schema/src/test/scala/endpoints/algebra/JsonSchemasDocs.scala#L7" class="a_sourcelink">JsonSchemasDocs.scala</a></div></div>
<p>We can represent instances of <code class="hljs">Rectangle</code> in JSON with a JSON object having properties corresponding
to the case class fields. A JSON schema for such objects would be defined as follows:</p>
<div class="row"><div class="a_linked small-expand columns a_xscroll a_codeblock">
<pre class="hljs"><code class="language-scala"><span class="hljs-keyword">implicit</span> <span class="hljs-keyword">val</span> rectangleSchema: <span class="hljs-type">JsonSchema</span>[<span class="hljs-type">Rectangle</span>] = (
  field[<span class="hljs-type">Double</span>](<span class="hljs-string">"width"</span>, <span class="hljs-type">Some</span>(<span class="hljs-string">"Rectangle width"</span>)) zip
  field[<span class="hljs-type">Double</span>](<span class="hljs-string">"height"</span>)
).invmap((<span class="hljs-type">Rectangle</span>.apply _).tupled)(rect =&gt; (rect.width, rect.height))</code></pre>
<a href="https://github.com/julienrf/endpoints/blob/v0.8.0/json-schema/json-schema/src/test/scala/endpoints/algebra/JsonSchemasDocs.scala#L10-L13" class="a_sourcelink">JsonSchemasDocs.scala</a></div></div>
<p>The <code class="hljs">field</code> constructor defines a JSON object schema with one field of the given
type and name (and an optional text documentation). A similar constructor, <code class="hljs">optField</code>,
defines an optional field in a JSON object.</p>
<p>In the above example, we define two JSON object schemas (one for the <code class="hljs">width</code> field,
of type <code class="hljs">Record[Double]</code>, and one for the <code class="hljs">height</code> field, of type <code class="hljs">Record[Double]</code>),
and then we combine them into a single JSON object schema by using the <code class="hljs">zip</code> operation. Finally, we call the <code class="hljs">invmap</code> operation
to turn the <code class="hljs">Record[(Double, Double)]</code> value returned by the <code class="hljs">zip</code> operation into
a <code class="hljs">Record[Rectangle]</code>.</p>
<h3 id="sum-types" class="a_section" data-magellan-target="sum-types">Sum types<a class="a_hlink" href="#sum-types"></a></h3>
<p>It is also possible to define schemas for sum types. Consider the following type definition,
defining a <code class="hljs">Shape</code>, which can be either a <code class="hljs">Circle</code> or a <code class="hljs">Rectangle</code>:</p>
<div class="row"><div class="a_linked small-expand columns a_xscroll a_codeblock">
<pre class="hljs"><code class="language-scala"><span class="hljs-keyword">sealed</span> <span class="hljs-class"><span class="hljs-keyword">trait</span> <span class="hljs-title">Shape</span></span>
<span class="hljs-keyword">case</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Circle</span>(<span class="hljs-params">radius: <span class="hljs-type">Double</span></span>) <span class="hljs-keyword">extends</span> <span class="hljs-title">Shape</span></span>
<span class="hljs-keyword">case</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Rectangle</span>(<span class="hljs-params">width: <span class="hljs-type">Double</span>, height: <span class="hljs-type">Double</span></span>) <span class="hljs-keyword">extends</span> <span class="hljs-title">Shape</span></span></code></pre>
<a href="https://github.com/julienrf/endpoints/blob/v0.8.0/json-schema/json-schema/src/test/scala/endpoints/algebra/JsonSchemasDocs.scala#L18-L20" class="a_sourcelink">JsonSchemasDocs.scala</a></div></div>
<p>A possible JSON schema for this data type consists in using a JSON object with a discriminator
field indicating whether the <code class="hljs">Shape</code> is a <code class="hljs">Rectangle</code> or a <code class="hljs">Circle</code>. Such a schema can
be defined as follows:</p>
<div class="row"><div class="a_linked small-expand columns a_xscroll a_codeblock">
<pre class="hljs"><code class="language-scala"><span class="hljs-comment">// Given a `circleSchema: Record[Circle]` and a `rectangleSchema: Record[Rectangle]`</span>
(
  circleSchema.tagged(<span class="hljs-string">"Circle"</span>) orElse
  rectangleSchema.tagged(<span class="hljs-string">"Rectangle"</span>)
).invmap[<span class="hljs-type">Shape</span>] {
  <span class="hljs-keyword">case</span> <span class="hljs-type">Left</span>(circle) =&gt; circle
  <span class="hljs-keyword">case</span> <span class="hljs-type">Right</span>(rect)  =&gt; rect
} {
  <span class="hljs-keyword">case</span> c: <span class="hljs-type">Circle</span>    =&gt; <span class="hljs-type">Left</span>(c)
  <span class="hljs-keyword">case</span> r: <span class="hljs-type">Rectangle</span> =&gt; <span class="hljs-type">Right</span>(r)
}</code></pre>
<a href="https://github.com/julienrf/endpoints/blob/v0.8.0/json-schema/json-schema/src/test/scala/endpoints/algebra/JsonSchemasDocs.scala#L35-L45" class="a_sourcelink">JsonSchemasDocs.scala</a></div></div>
<p>(We have omitted the definition of <code class="hljs">circleSchema</code> for the sake of conciseness)</p>
<p>The <code class="hljs">orElse</code> operation turns the <code class="hljs">Record[Circle]</code> and <code class="hljs">Record[Rectangle]</code> values into
a <code class="hljs">Record[Either[Circle, Rectangle]]</code>, which is then transformed into a <code class="hljs">Record[Shape]</code> by
using <code class="hljs">invmap</code>.</p>
<p>By default, the discriminator field is named <code class="hljs">type</code>, but you can use another field name if
you want to.</p>
<h3 id="enumerations" class="a_section" data-magellan-target="enumerations">Enumerations<a class="a_hlink" href="#enumerations"></a></h3>
<p>There are different ways to represent enumerations in Scala:</p>
<ul>
<li><code class="hljs">scala.util.Enumeration</code></li>
<li>Sealed trait with case objects</li>
<li>Third-party libraries, e.g. Enumeratum</li>
</ul>
<p>For example, an enumeration with three possible values can be defined as a sealed trait with three case objects:</p>
<div class="row"><div class="a_linked small-expand columns a_xscroll a_codeblock">
<pre class="hljs"><code class="language-scala"><span class="hljs-keyword">sealed</span> <span class="hljs-class"><span class="hljs-keyword">trait</span> <span class="hljs-title">Status</span></span>
<span class="hljs-keyword">case</span> <span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">Active</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Status</span></span>
<span class="hljs-keyword">case</span> <span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">Inactive</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Status</span></span>
<span class="hljs-keyword">case</span> <span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">Obsolete</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Status</span></span></code></pre>
<a href="https://github.com/julienrf/endpoints/blob/v0.8.0/json-schema/json-schema/src/test/scala/endpoints/algebra/JsonSchemasDocs.scala#L52-L55" class="a_sourcelink">JsonSchemasDocs.scala</a></div></div>
<p>The method <code class="hljs">enumeration</code> in the <code class="hljs">JsonSchemas</code> algebra supports mapping the enum values to JSON strings.
It has two parameters: the possible values, and a function to encode an enum value as a string.</p>
<div class="row"><div class="a_linked small-expand columns a_xscroll a_codeblock">
<pre class="hljs"><code class="language-scala"><span class="hljs-keyword">implicit</span> <span class="hljs-keyword">lazy</span> <span class="hljs-keyword">val</span> statusSchema: <span class="hljs-type">JsonSchema</span>[<span class="hljs-type">Status</span>] =
  enumeration[<span class="hljs-type">Status</span>](<span class="hljs-type">Seq</span>(<span class="hljs-type">Active</span>, <span class="hljs-type">Inactive</span>, <span class="hljs-type">Obsolete</span>))(_.toString)</code></pre>
<a href="https://github.com/julienrf/endpoints/blob/v0.8.0/json-schema/json-schema/src/test/scala/endpoints/algebra/JsonSchemasDocs.scala#L58-L59" class="a_sourcelink">JsonSchemasDocs.scala</a></div></div>
<p>The resulting <code class="hljs">JsonSchema[Status]</code> allows defining JSON members with string values that are mapped to our case objects.</p>
<p>It will work similarly for other representations of enumerated values.
Most of them provide <code class="hljs">values</code> which can conveniently be passed into <code class="hljs">enumeration</code>.
However, it is still possible to explicitly pass a certain subset of allowed values.</p>
<h3 id="recursive-types" class="a_section" data-magellan-target="recursive-types">Recursive types<a class="a_hlink" href="#recursive-types"></a></h3>
<p>You can reference a currently being defined schema without causing a <code class="hljs">StackOverflow</code> error
by wrapping it in the <code class="hljs">lazySchema</code> constructor:</p>
<div class="row"><div class="a_linked small-expand columns a_xscroll a_codeblock">
<pre class="hljs"><code class="language-scala"><span class="hljs-keyword">case</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Rec</span>(<span class="hljs-params">next: <span class="hljs-type">Option</span>[<span class="hljs-type">Rec</span>]</span>)</span>

<span class="hljs-keyword">val</span> recSchema: <span class="hljs-type">JsonSchema</span>[<span class="hljs-type">Rec</span>] = (
  optField(<span class="hljs-string">"next"</span>)(lazySchema(recSchema, <span class="hljs-string">"Rec"</span>))
).invmap(<span class="hljs-type">Rec</span>)(_.next)</code></pre>
<a href="https://github.com/julienrf/endpoints/blob/v0.8.0/json-schema/json-schema/src/test/scala/endpoints/algebra/JsonSchemasDocs.scala#L64-L68" class="a_sourcelink">JsonSchemasDocs.scala</a></div></div>
<h2 id="generic-derivation-of-json-schemas" class="a_section" data-magellan-target="generic-derivation-of-json-schemas">Generic derivation of JSON schemas<a class="a_hlink" href="#generic-derivation-of-json-schemas"></a></h2>
<p>The module presented in this section uses Shapeless to generically derive JSON schemas
for algebraic data types.</p>
<div class="row"><div class="a_linked small-expand columns a_xscroll a_codeblock">
<pre class="hljs"><code class="language-scala"><span class="hljs-string">"org.julienrf"</span> %% <span class="hljs-string">"endpoints-json-schema-generic"</span> % <span class="hljs-string">"0.8.0"</span>
</code></pre>
</div></div>
<p><a href="../api/0.8.0/index.html#endpoints.generic.JsonSchemas">API documentation</a></p>
<p>With this module, defining the JSON schema of the <code class="hljs">Shape</code> data type is
reduced to the following:</p>
<div class="row"><div class="a_linked small-expand columns a_xscroll a_codeblock">
<pre class="hljs"><code class="language-scala"><span class="hljs-keyword">implicit</span> <span class="hljs-keyword">val</span> shapeSchema: <span class="hljs-type">JsonSchema</span>[<span class="hljs-type">Shape</span>] = genericJsonSchema</code></pre>
<a href="https://github.com/julienrf/endpoints/blob/v0.8.0/json-schema/json-schema-generic/src/test/scala/endpoints/generic/JsonSchemasDocs.scala#L10" class="a_sourcelink">JsonSchemasDocs.scala</a></div></div>
<p>The <code class="hljs">genericJsonSchema</code> operation builds a JSON schema for the given
type, mapping each case class field to a JSON object field of the same name,
and each leaf of a sealed trait to a tagged JSON object whose type discriminator
uses the case class name.</p>
<p>The module also takes advantage shapeless to define more convenient
operations for combining JSON schema definitions: the <code class="hljs">zip</code> operation
is replaced by a <code class="hljs">:*:</code> operator, and <code class="hljs">invmap</code> is replaced by <code class="hljs">as</code>:</p>
<div class="row"><div class="a_linked small-expand columns a_xscroll a_codeblock">
<pre class="hljs"><code class="language-scala"><span class="hljs-keyword">implicit</span> <span class="hljs-keyword">val</span> rectangleSchema: <span class="hljs-type">JsonSchema</span>[<span class="hljs-type">Rectangle</span>] = (
  field[<span class="hljs-type">Double</span>](<span class="hljs-string">"width"</span>) :*:
  field[<span class="hljs-type">Double</span>](<span class="hljs-string">"height"</span>)
).as[<span class="hljs-type">Rectangle</span>]</code></pre>
<a href="https://github.com/julienrf/endpoints/blob/v0.8.0/json-schema/json-schema-generic/src/test/scala/endpoints/generic/JsonSchemasDocs.scala#L15-L18" class="a_sourcelink">JsonSchemasDocs.scala</a></div></div>

                 
  <ul class="menu align-right simple a_navbar a_navbar_bottom">
    
      
        <li><a href="../site-contents.html"  title="Table of Contents" ><span class="a_foundation_icon"></span>  Contents</a></li>
      
    
  </ul>
 
              </main>
              
              
                <div data-sticky-container class="small-12 medium-12 large-2 large-order-1 columns a_sitenav_container">
                  <nav class="a_sitenav" data-sticky data-sticky-on="large" data-anchor="_sections">
                    
                    <ul>
                       
  <li >
    
      
        <a href="../index.html">Introduction</a>
      
    
    
  </li>
  
  <li >
    
      
        <a href="../use-cases.html">Use Cases</a>
      
    
    
  </li>
  
  <li >
    
      
        <a href="../quick-start.html">Quick start</a>
      
    
    
  </li>
  
  <li >
    
      
        <a href="../algebras-and-interpreters.html">Algebras and interpreters</a>
      
    
    
  </li>
  
  <li >
    
      
        <a href="../design.html">Design in a nutshell</a>
      
    
    
  </li>
  
  <li >
    
      
        <a href="../guides.html">Guides</a>
      
    
    
  </li>
  
  <li >
    
      
        <a href="../comparison.html">Comparison with similar tools</a>
      
    
    
  </li>
  
  <li >
    
      
        <a href="../talks.html">Talks and Publications</a>
      
    
    
  </li>
 
                    </ul>
                    
                    
                  </nav>
                </div>
              
              
              
                <div class="small-12 medium-12 large-2 large-order-3 columns a_show-for-xlarge" data-sticky-container>
                  <nav class="a_pagenav" data-sticky data-sticky-on="large" data-anchor="_sections">
                     <header><p>On This Page</p>
</header> 
                    <ul class="vertical menu" data-magellan>
                       
  
    <li>
      
         <a href="#json-schemas">JSON schemas</a> 
      
      
        <ul class="vertical menu">  
  
    <li>
      
         <a href="#jsonschemas">JsonSchemas</a> 
      
      
        <ul class="vertical menu">  
  
    <li>
      
         <a href="#basic-types-and-record-types">Basic types and record types</a> 
      
      
    </li>
  
  
  
    <li>
      
         <a href="#sum-types">Sum types</a> 
      
      
    </li>
  
  
  
    <li>
      
         <a href="#enumerations">Enumerations</a> 
      
      
    </li>
  
  
  
    <li>
      
         <a href="#recursive-types">Recursive types</a> 
      
      
    </li>
  
  </ul>
      
    </li>
  
  
  
    <li>
      
         <a href="#generic-derivation-of-json-schemas">Generic derivation of JSON schemas</a> 
      
      
    </li>
  
  </ul>
      
    </li>
  
 
                    </ul>
                  </nav>
                </div>
              
            </div>
          </div>
        </div>
      </div>
      
      <footer class="small-12 medium-12 large-12 columns align-self-bottom a_footer">
        <div class="row">
          <div class="small-12 medium-12 large-12 columns top-bar">
            <div class="top-bar-left">
              
            </div>
            <div class="top-bar-right">
              <p>Generated with <a href="https://github.com/szeiger/ornate">Ornate</a>.</p>

            </div>
          </div>
        </div>
      </footer>
    </div>
    
    <script src="../theme/js/jquery.min.js"></script>
    <script src="../theme/js/what-input.min.js"></script>
    <script src="../theme/js/foundation.min.js"></script>
    
    <script src="../theme/js/app.js"></script>
    
  </body>
</html>
